---
title: Verteiltes Zwischenspeichern in ASP.net Core
author: rick-anderson
description: Erfahren Sie, wie Sie einen ASP.net Core verteilten Cache verwenden können, um die Leistung und Skalierbarkeit der APP zu verbessern, insbesondere in einer Cloud-oder Serverfarm Umgebung.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/07/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: performance/caching/distributed
ms.openlocfilehash: 6f89046f2e1805111dd81b3282253a72a7c6ea09
ms.sourcegitcommit: 1166b0ff3828418559510c661e8240e5c5717bb7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/12/2021
ms.locfileid: "100281017"
---
# <a name="distributed-caching-in-aspnet-core"></a><span data-ttu-id="31446-103">Verteiltes Zwischenspeichern in ASP.net Core</span><span class="sxs-lookup"><span data-stu-id="31446-103">Distributed caching in ASP.NET Core</span></span>

<span data-ttu-id="31446-104">Von " [nahusin Nasir](https://github.com/mohsinnasir) " und [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="31446-104">By [Mohsin Nasir](https://github.com/mohsinnasir) and [Steve Smith](https://ardalis.com/)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="31446-105">Bei einem verteilten Cache handelt es sich um einen Cache, der von mehreren App-Servern gemeinsam verwendet wird, die in der Regel als externer Dienst für die App-Server verwaltet werden</span><span class="sxs-lookup"><span data-stu-id="31446-105">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="31446-106">Ein verteilter Cache kann die Leistung und Skalierbarkeit einer ASP.net Core-App verbessern, insbesondere wenn die APP von einem Cloud-Dienst oder einer Serverfarm gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-106">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="31446-107">Ein verteilter Cache hat mehrere Vorteile gegenüber anderen cachingszenarien, in denen zwischengespeicherte Daten auf einzelnen App-Servern gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="31446-107">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="31446-108">Wenn zwischengespeicherte Daten verteilt werden, sind die Daten wie folgt:</span><span class="sxs-lookup"><span data-stu-id="31446-108">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="31446-109">Ist *in* allen Anforderungen an mehrere Server konsistent (konsistent).</span><span class="sxs-lookup"><span data-stu-id="31446-109">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="31446-110">Überstehen Serverneustarts und App-bereit Stellungen.</span><span class="sxs-lookup"><span data-stu-id="31446-110">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="31446-111">Verwendet keinen lokalen Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="31446-111">Doesn't use local memory.</span></span>

<span data-ttu-id="31446-112">Die Konfiguration verteilter Caches ist Implementierungs spezifisch.</span><span class="sxs-lookup"><span data-stu-id="31446-112">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="31446-113">In diesem Artikel wird beschrieben, wie Sie SQL Server und verteilte redis-Caches konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="31446-113">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="31446-114">Implementierungen von Drittanbietern sind ebenfalls verfügbar, wie z. b. [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="31446-114">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="31446-115">Unabhängig davon, welche Implementierung ausgewählt ist, interagiert die App mithilfe der-Schnittstelle mit dem Cache <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-115">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="31446-116">[Anzeigen oder Herunterladen von Beispielcode](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([Vorgehensweise zum Herunterladen](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="31446-116">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="31446-117">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="31446-117">Prerequisites</span></span>

<span data-ttu-id="31446-118">Um einen SQL Server verteilten Cache zu verwenden, fügen Sie dem Paket " [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) " einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-118">To use a SQL Server distributed cache, add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="31446-119">Um einen verteilten redis-Cache zu verwenden, fügen Sie dem Paket [Microsoft. Extensions. Caching. stackexchangeredis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-119">To use a Redis distributed cache, add a package reference to the [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) package.</span></span>

<span data-ttu-id="31446-120">Fügen Sie zum Verwenden von NCache-verteiltem Cache einen Paket Verweis zum [ncache. Microsoft. Extensions. Caching. opensource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) -Paket hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-120">To use NCache distributed cache, add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="31446-121">Idistributedcache-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="31446-121">IDistributedCache interface</span></span>

<span data-ttu-id="31446-122">Die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle stellt die folgenden Methoden zum Bearbeiten von Elementen in der Implementierung verteilter Caches bereit:</span><span class="sxs-lookup"><span data-stu-id="31446-122">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="31446-123"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> : Akzeptiert einen Zeichen folgen Schlüssel und ruft ein zwischengespeichertes Element als-Array ab, `byte[]` Wenn es im Cache gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="31446-123"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*>: Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="31446-124"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> : Fügt dem Cache ein Element (als `byte[]` Array) mithilfe eines Zeichen folgen Schlüssels hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-124"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*>: Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="31446-125"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> : Aktualisiert ein Element im Cache auf der Grundlage seines Schlüssels und setzt das gleitende Ablauf Timeout (sofern vorhanden) zurück.</span><span class="sxs-lookup"><span data-stu-id="31446-125"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*>: Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="31446-126"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> : Entfernt ein Cache Element basierend auf seinem Zeichen folgen Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="31446-126"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*>: Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="31446-127">Einrichten verteilter Cache Dienste</span><span class="sxs-lookup"><span data-stu-id="31446-127">Establish distributed caching services</span></span>

<span data-ttu-id="31446-128">Registrieren Sie eine Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="31446-128">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="31446-129">Die in diesem Thema beschriebenen Framework-Implementierungen umfassen Folgendes:</span><span class="sxs-lookup"><span data-stu-id="31446-129">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="31446-130">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-130">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="31446-131">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-131">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="31446-132">Verteilter redis-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-132">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="31446-133">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-133">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="31446-134">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-134">Distributed Memory Cache</span></span>

<span data-ttu-id="31446-135">Der verteilte Arbeitsspeicher Cache ( <xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*> ) ist eine vom Framework bereitgestellte Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> , die Elemente im Arbeitsspeicher speichert.</span><span class="sxs-lookup"><span data-stu-id="31446-135">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="31446-136">Der verteilte Arbeitsspeicher Cache ist kein tatsächlicher verteilter Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-136">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="31446-137">Zwischengespeicherte Elemente werden von der app-Instanz auf dem Server gespeichert, auf dem die app ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-137">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="31446-138">Der verteilte Arbeitsspeicher Cache ist eine nützliche Implementierung:</span><span class="sxs-lookup"><span data-stu-id="31446-138">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="31446-139">In Entwicklungs-und Testszenarien.</span><span class="sxs-lookup"><span data-stu-id="31446-139">In development and testing scenarios.</span></span>
* <span data-ttu-id="31446-140">Wenn ein einzelner Server in der Produktionsumgebung verwendet wird, ist der Arbeitsspeicher Verbrauch kein Problem.</span><span class="sxs-lookup"><span data-stu-id="31446-140">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="31446-141">Durch das Implementieren des Cache für verteilte Arbeitsspeicher wird der zwischengespeicherte Datenspeicher</span><span class="sxs-lookup"><span data-stu-id="31446-141">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="31446-142">Sie ermöglicht die Implementierung einer echten verteilten cachinglösung in Zukunft, wenn mehrere Knoten oder Fehlertoleranz erforderlich werden.</span><span class="sxs-lookup"><span data-stu-id="31446-142">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="31446-143">Die Beispiel-App nutzt den verteilten Arbeitsspeicher Cache, wenn die app in der Entwicklungsumgebung in ausgeführt wird `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-143">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="31446-144">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-144">Distributed SQL Server Cache</span></span>

<span data-ttu-id="31446-145">Die verteilte SQL Server Cache Implementierung ( <xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*> ) ermöglicht es dem verteilten Cache, eine SQL Server Datenbank als Sicherungs Speicher zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-145">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="31446-146">Zum Erstellen einer SQL Server zwischengespeicherten Element Tabelle in einer SQL Server Instanz können Sie das `sql-cache` Tool verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-146">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="31446-147">Das Tool erstellt eine Tabelle mit dem Namen und dem Schema, die Sie angeben.</span><span class="sxs-lookup"><span data-stu-id="31446-147">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="31446-148">Erstellen Sie eine Tabelle in SQL Server, indem Sie den `sql-cache create` Befehl ausführen.</span><span class="sxs-lookup"><span data-stu-id="31446-148">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="31446-149">Geben Sie die SQL Server Instanz ( `Data Source` ), die Datenbank ( `Initial Catalog` ), das Schema (z. b. `dbo` ) und den Tabellennamen (z. b. `TestCache` ) an:</span><span class="sxs-lookup"><span data-stu-id="31446-149">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="31446-150">Eine Meldung wird protokolliert, um anzuzeigen, dass das Tool erfolgreich war:</span><span class="sxs-lookup"><span data-stu-id="31446-150">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="31446-151">Die vom Tool erstellte Tabelle `sql-cache` hat das folgende Schema:</span><span class="sxs-lookup"><span data-stu-id="31446-151">The table created by the `sql-cache` tool has the following schema:</span></span>

![SQLServer-Cache Tabelle](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="31446-153">Eine APP sollte Cache Werte mithilfe einer Instanz von, nicht mithilfe von bearbeiten <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-153">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="31446-154">Die Beispiel-App implementiert in <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> einer nicht Entwicklungsumgebung in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-154">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="31446-155">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (und optional <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> und <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*> ) werden in der Regel außerhalb der Quell Code Verwaltung gespeichert (z. b. durch den [Geheimnis-Manager](xref:security/app-secrets) oder in *appsettings.json* / *appSettings gespeichert. { Umgebung}. JSON* -Dateien).</span><span class="sxs-lookup"><span data-stu-id="31446-155">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="31446-156">Die Verbindungs Zeichenfolge kann Anmelde Informationen enthalten, die aus den Quell Code Verwaltungssystemen ausgeschlossen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="31446-156">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="31446-157">Verteilte redis Cache</span><span class="sxs-lookup"><span data-stu-id="31446-157">Distributed Redis Cache</span></span>

<span data-ttu-id="31446-158">[Redis](https://redis.io/) ist ein Open Source-Datenspeicher im Arbeitsspeicher, der häufig als verteilter Cache verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-158">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span>  <span data-ttu-id="31446-159">Sie können eine [Azure redis Cache](https://azure.microsoft.com/services/cache/) für eine in Azure gehostete ASP.net Core-App konfigurieren und eine Azure redis Cache für die lokale Entwicklung verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-159">You can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app, and use an Azure Redis Cache for local development.</span></span>

<span data-ttu-id="31446-160">Eine App konfiguriert die Cache Implementierung mithilfe einer- <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> Instanz ( <xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*> ).</span><span class="sxs-lookup"><span data-stu-id="31446-160">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>).</span></span>

<span data-ttu-id="31446-161">Weitere Informationen finden Sie unter [Azure Cache for Redis](/azure/azure-cache-for-redis/cache-overview).</span><span class="sxs-lookup"><span data-stu-id="31446-161">For more information, see [Azure Cache for Redis](/azure/azure-cache-for-redis/cache-overview).</span></span>

<span data-ttu-id="31446-162">In [diesem GitHub-Problem](https://github.com/dotnet/AspNetCore.Docs/issues/19542) finden Sie eine Erläuterung zu alternativen Ansätzen für einen lokalen redis Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-162">See [this GitHub issue](https://github.com/dotnet/AspNetCore.Docs/issues/19542) for a discussion on alternative approaches to a local Redis cache.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="31446-163">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-163">Distributed NCache Cache</span></span>

<span data-ttu-id="31446-164">[NCache](https://github.com/Alachisoft/NCache) ist ein Open Source-verteilter, in-Memory-Cache, der System intern in .net und .net Core entwickelt wurde.</span><span class="sxs-lookup"><span data-stu-id="31446-164">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="31446-165">NCache funktioniert sowohl lokal als auch als verteilter Cache Cluster für eine ASP.net Core-APP, die in Azure oder auf anderen Hostingplattformen ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-165">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="31446-166">Informationen zum Installieren und Konfigurieren von NCache auf Ihrem lokalen Computer finden Sie unter Leitfaden für die ersten Schritte [für Windows (.net und .net Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="31446-166">To install and configure NCache on your local machine, see [Getting Started Guide for Windows (.NET and .NET Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span></span>

<span data-ttu-id="31446-167">So konfigurieren Sie NCache:</span><span class="sxs-lookup"><span data-stu-id="31446-167">To configure NCache:</span></span>

1. <span data-ttu-id="31446-168">Installieren [Sie NCache Open Source nuget](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="31446-168">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="31446-169">Konfigurieren Sie den Cache Cluster in " [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html)".</span><span class="sxs-lookup"><span data-stu-id="31446-169">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="31446-170">Fügen Sie den folgenden Code zu `Startup.ConfigureServices` hinzu:</span><span class="sxs-lookup"><span data-stu-id="31446-170">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="31446-171">Verwenden des verteilten Caches</span><span class="sxs-lookup"><span data-stu-id="31446-171">Use the distributed cache</span></span>

<span data-ttu-id="31446-172">Um die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle zu verwenden, fordern Sie eine Instanz von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> von einem beliebigen Konstruktor in der APP an.</span><span class="sxs-lookup"><span data-stu-id="31446-172">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="31446-173">Die-Instanz wird von der [Abhängigkeitsinjektion (di)](xref:fundamentals/dependency-injection)bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="31446-173">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="31446-174">Wenn die Beispiel-App gestartet wird, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in eingefügt `Startup.Configure` .</span><span class="sxs-lookup"><span data-stu-id="31446-174">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="31446-175">Die aktuelle Zeit wird mithilfe von zwischengespeichert <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (Weitere Informationen finden Sie unter [generischer Host: ihostapplicationlifetime](xref:fundamentals/host/generic-host#ihostapplicationlifetime)):</span><span class="sxs-lookup"><span data-stu-id="31446-175">The current time is cached using <xref:Microsoft.Extensions.Hosting.IHostApplicationLifetime> (for more information, see [Generic Host: IHostApplicationLifetime](xref:fundamentals/host/generic-host#ihostapplicationlifetime)):</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="31446-176">Die Beispiel-APP <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in den eingefügt, `IndexModel` um von der Index Seite verwendet werden zu können.</span><span class="sxs-lookup"><span data-stu-id="31446-176">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="31446-177">Jedes Mal, wenn die Index Seite geladen wird, wird der Cache für die zwischengespeicherte Zeit in geprüft `OnGetAsync` .</span><span class="sxs-lookup"><span data-stu-id="31446-177">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="31446-178">Wenn die zwischengespeicherte Zeit nicht abgelaufen ist, wird die Uhrzeit angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-178">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="31446-179">Wenn 20 Sekunden seit dem letzten Zugriff auf die zwischengespeicherte Zeit (beim letzten Laden dieser Seite) verstrichen sind, wird auf der Seite die *zwischengespeicherte Zeit abgelaufen* angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-179">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="31446-180">Aktualisieren Sie die zwischengespeicherte Zeit sofort auf die aktuelle Zeit, indem Sie die Schaltfläche **zwischengespeicherte Zeit zurücksetzen** auswählen.</span><span class="sxs-lookup"><span data-stu-id="31446-180">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="31446-181">Die Schaltfläche löst die `OnPostResetCachedTime` Handlermethode aus.</span><span class="sxs-lookup"><span data-stu-id="31446-181">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/3.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="31446-182">Es ist nicht erforderlich, eine Singleton-oder Gültigkeitsdauer für <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanzen (zumindest für die integrierten Implementierungen) zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-182">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="31446-183">Sie können auch immer dann eine <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanz erstellen, wenn Sie eine Instanz benötigen, anstatt di zu verwenden, aber das Erstellen einer Instanz im Code kann dazu führen, dass Ihr Code schwieriger zu testen ist und gegen das [explizite Abhängigkeits Prinzip](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies)verstößt.</span><span class="sxs-lookup"><span data-stu-id="31446-183">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="31446-184">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="31446-184">Recommendations</span></span>

<span data-ttu-id="31446-185"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>Beachten Sie Folgendes, wenn Sie entscheiden, welche Implementierung von für Ihre APP am besten geeignet ist:</span><span class="sxs-lookup"><span data-stu-id="31446-185">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="31446-186">Vorhandene Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="31446-186">Existing infrastructure</span></span>
* <span data-ttu-id="31446-187">Leistungsanforderungen</span><span class="sxs-lookup"><span data-stu-id="31446-187">Performance requirements</span></span>
* <span data-ttu-id="31446-188">„Cost“ (Kosten)</span><span class="sxs-lookup"><span data-stu-id="31446-188">Cost</span></span>
* <span data-ttu-id="31446-189">Team Darstellung</span><span class="sxs-lookup"><span data-stu-id="31446-189">Team experience</span></span>

<span data-ttu-id="31446-190">Zwischen Speicherungs Lösungen basieren in der Regel auf in-Memory-Speicher, um das schnelle Abrufen von zwischengespeicherten Daten zu ermöglichen, aber der Arbeitsspeicher ist eine begrenzte Ressource und ist aufwändig</span><span class="sxs-lookup"><span data-stu-id="31446-190">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="31446-191">Speichert nur häufig verwendete Daten in einem Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-191">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="31446-192">Im Allgemeinen bietet ein redis Cache einen höheren Durchsatz und eine niedrigere Latenz als bei einem SQL Server Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-192">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="31446-193">Es ist jedoch normalerweise ein Benchmarkwert erforderlich, um die Leistungsmerkmale von Cache Strategien zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="31446-193">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="31446-194">Wenn SQL Server als Sicherungs Speicher für verteilte Caches verwendet wird, kann sich die Verwendung der gleichen Datenbank für den Cache und den normalen Datenspeicher und-Abruf der APP negativ auf die Leistung beider Anwendungen auswirken.</span><span class="sxs-lookup"><span data-stu-id="31446-194">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="31446-195">Es wird empfohlen, für den Sicherungs Speicher im verteilten Cache eine dedizierte SQL Server Instanz zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-195">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="31446-196">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="31446-196">Additional resources</span></span>

* [<span data-ttu-id="31446-197">Redis Cache in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-197">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="31446-198">SQL-Datenbank in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-198">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="31446-199">[ASP.net Core idistributedcache-Anbieter für NCache in Webfarmen](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="31446-199">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="31446-200">Bei einem verteilten Cache handelt es sich um einen Cache, der von mehreren App-Servern gemeinsam verwendet wird, die in der Regel als externer Dienst für die App-Server verwaltet werden</span><span class="sxs-lookup"><span data-stu-id="31446-200">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="31446-201">Ein verteilter Cache kann die Leistung und Skalierbarkeit einer ASP.net Core-App verbessern, insbesondere wenn die APP von einem Cloud-Dienst oder einer Serverfarm gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-201">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="31446-202">Ein verteilter Cache hat mehrere Vorteile gegenüber anderen cachingszenarien, in denen zwischengespeicherte Daten auf einzelnen App-Servern gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="31446-202">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="31446-203">Wenn zwischengespeicherte Daten verteilt werden, sind die Daten wie folgt:</span><span class="sxs-lookup"><span data-stu-id="31446-203">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="31446-204">Ist *in* allen Anforderungen an mehrere Server konsistent (konsistent).</span><span class="sxs-lookup"><span data-stu-id="31446-204">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="31446-205">Überstehen Serverneustarts und App-bereit Stellungen.</span><span class="sxs-lookup"><span data-stu-id="31446-205">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="31446-206">Verwendet keinen lokalen Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="31446-206">Doesn't use local memory.</span></span>

<span data-ttu-id="31446-207">Die Konfiguration verteilter Caches ist Implementierungs spezifisch.</span><span class="sxs-lookup"><span data-stu-id="31446-207">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="31446-208">In diesem Artikel wird beschrieben, wie Sie SQL Server und verteilte redis-Caches konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="31446-208">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="31446-209">Implementierungen von Drittanbietern sind ebenfalls verfügbar, wie z. b. [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="31446-209">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="31446-210">Unabhängig davon, welche Implementierung ausgewählt ist, interagiert die App mithilfe der-Schnittstelle mit dem Cache <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-210">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="31446-211">[Anzeigen oder Herunterladen von Beispielcode](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([Vorgehensweise zum Herunterladen](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="31446-211">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="31446-212">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="31446-212">Prerequisites</span></span>

<span data-ttu-id="31446-213">Wenn Sie einen SQL Server verteilten Cache verwenden möchten, verweisen Sie auf das [Metapaket "Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) ", oder fügen Sie dem Paket " [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) " einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-213">To use a SQL Server distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) or add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="31446-214">Um einen verteilten redis-Cache zu verwenden, verweisen Sie auf das [Metapaket Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) , und fügen Sie dem Paket [Microsoft. Extensions. Caching. stackexchangeredis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-214">To use a Redis distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [Microsoft.Extensions.Caching.StackExchangeRedis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis) package.</span></span> <span data-ttu-id="31446-215">Das redis-Paket ist nicht im `Microsoft.AspNetCore.App` Paket enthalten. Daher müssen Sie das redis-Paket separat in der Projektdatei referenzieren.</span><span class="sxs-lookup"><span data-stu-id="31446-215">The Redis package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the Redis package separately in your project file.</span></span>

<span data-ttu-id="31446-216">Um den verteilten NCache-Cache zu verwenden, verweisen Sie auf das [Metapaket "Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) ", und fügen Sie dem [ncache. Microsoft. Extensions. Caching. opensource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) -Paket einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-216">To use NCache distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span> <span data-ttu-id="31446-217">Das NCache-Paket ist nicht im `Microsoft.AspNetCore.App` Paket enthalten. Daher müssen Sie in der Projektdatei separat auf das NCache-Paket verweisen.</span><span class="sxs-lookup"><span data-stu-id="31446-217">The NCache package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the NCache package separately in your project file.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="31446-218">Idistributedcache-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="31446-218">IDistributedCache interface</span></span>

<span data-ttu-id="31446-219">Die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle stellt die folgenden Methoden zum Bearbeiten von Elementen in der Implementierung verteilter Caches bereit:</span><span class="sxs-lookup"><span data-stu-id="31446-219">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="31446-220"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> : Akzeptiert einen Zeichen folgen Schlüssel und ruft ein zwischengespeichertes Element als-Array ab, `byte[]` Wenn es im Cache gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="31446-220"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*>: Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="31446-221"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> : Fügt dem Cache ein Element (als `byte[]` Array) mithilfe eines Zeichen folgen Schlüssels hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-221"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*>: Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="31446-222"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> : Aktualisiert ein Element im Cache auf der Grundlage seines Schlüssels und setzt das gleitende Ablauf Timeout (sofern vorhanden) zurück.</span><span class="sxs-lookup"><span data-stu-id="31446-222"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*>: Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="31446-223"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> : Entfernt ein Cache Element basierend auf seinem Zeichen folgen Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="31446-223"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*>: Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="31446-224">Einrichten verteilter Cache Dienste</span><span class="sxs-lookup"><span data-stu-id="31446-224">Establish distributed caching services</span></span>

<span data-ttu-id="31446-225">Registrieren Sie eine Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="31446-225">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="31446-226">Die in diesem Thema beschriebenen Framework-Implementierungen umfassen Folgendes:</span><span class="sxs-lookup"><span data-stu-id="31446-226">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="31446-227">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-227">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="31446-228">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-228">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="31446-229">Verteilter redis-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-229">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="31446-230">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-230">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="31446-231">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-231">Distributed Memory Cache</span></span>

<span data-ttu-id="31446-232">Der verteilte Arbeitsspeicher Cache ( <xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*> ) ist eine vom Framework bereitgestellte Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> , die Elemente im Arbeitsspeicher speichert.</span><span class="sxs-lookup"><span data-stu-id="31446-232">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="31446-233">Der verteilte Arbeitsspeicher Cache ist kein tatsächlicher verteilter Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-233">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="31446-234">Zwischengespeicherte Elemente werden von der app-Instanz auf dem Server gespeichert, auf dem die app ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-234">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="31446-235">Der verteilte Arbeitsspeicher Cache ist eine nützliche Implementierung:</span><span class="sxs-lookup"><span data-stu-id="31446-235">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="31446-236">In Entwicklungs-und Testszenarien.</span><span class="sxs-lookup"><span data-stu-id="31446-236">In development and testing scenarios.</span></span>
* <span data-ttu-id="31446-237">Wenn ein einzelner Server in der Produktionsumgebung verwendet wird, ist der Arbeitsspeicher Verbrauch kein Problem.</span><span class="sxs-lookup"><span data-stu-id="31446-237">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="31446-238">Durch das Implementieren des Cache für verteilte Arbeitsspeicher wird der zwischengespeicherte Datenspeicher</span><span class="sxs-lookup"><span data-stu-id="31446-238">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="31446-239">Sie ermöglicht die Implementierung einer echten verteilten cachinglösung in Zukunft, wenn mehrere Knoten oder Fehlertoleranz erforderlich werden.</span><span class="sxs-lookup"><span data-stu-id="31446-239">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="31446-240">Die Beispiel-App nutzt den verteilten Arbeitsspeicher Cache, wenn die app in der Entwicklungsumgebung in ausgeführt wird `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-240">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="31446-241">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-241">Distributed SQL Server Cache</span></span>

<span data-ttu-id="31446-242">Die verteilte SQL Server Cache Implementierung ( <xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*> ) ermöglicht es dem verteilten Cache, eine SQL Server Datenbank als Sicherungs Speicher zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-242">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="31446-243">Zum Erstellen einer SQL Server zwischengespeicherten Element Tabelle in einer SQL Server Instanz können Sie das `sql-cache` Tool verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-243">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="31446-244">Das Tool erstellt eine Tabelle mit dem Namen und dem Schema, die Sie angeben.</span><span class="sxs-lookup"><span data-stu-id="31446-244">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="31446-245">Erstellen Sie eine Tabelle in SQL Server, indem Sie den `sql-cache create` Befehl ausführen.</span><span class="sxs-lookup"><span data-stu-id="31446-245">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="31446-246">Geben Sie die SQL Server Instanz ( `Data Source` ), die Datenbank ( `Initial Catalog` ), das Schema (z. b. `dbo` ) und den Tabellennamen (z. b. `TestCache` ) an:</span><span class="sxs-lookup"><span data-stu-id="31446-246">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="31446-247">Eine Meldung wird protokolliert, um anzuzeigen, dass das Tool erfolgreich war:</span><span class="sxs-lookup"><span data-stu-id="31446-247">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="31446-248">Die vom Tool erstellte Tabelle `sql-cache` hat das folgende Schema:</span><span class="sxs-lookup"><span data-stu-id="31446-248">The table created by the `sql-cache` tool has the following schema:</span></span>

![SQLServer-Cache Tabelle](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="31446-250">Eine APP sollte Cache Werte mithilfe einer Instanz von, nicht mithilfe von bearbeiten <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-250">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="31446-251">Die Beispiel-App implementiert in <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> einer nicht Entwicklungsumgebung in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-251">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="31446-252">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (und optional <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> und <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*> ) werden in der Regel außerhalb der Quell Code Verwaltung gespeichert (z. b. durch den [Geheimnis-Manager](xref:security/app-secrets) oder in *appsettings.json* / *appSettings gespeichert. { Umgebung}. JSON* -Dateien).</span><span class="sxs-lookup"><span data-stu-id="31446-252">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="31446-253">Die Verbindungs Zeichenfolge kann Anmelde Informationen enthalten, die aus den Quell Code Verwaltungssystemen ausgeschlossen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="31446-253">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="31446-254">Verteilte redis Cache</span><span class="sxs-lookup"><span data-stu-id="31446-254">Distributed Redis Cache</span></span>

<span data-ttu-id="31446-255">[Redis](https://redis.io/) ist ein Open Source-Datenspeicher im Arbeitsspeicher, der häufig als verteilter Cache verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-255">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span> <span data-ttu-id="31446-256">Sie können redis lokal verwenden, und Sie können eine [Azure redis Cache](https://azure.microsoft.com/services/cache/) für eine in Azure gehostete ASP.net Core-App konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="31446-256">You can use Redis locally, and you can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app.</span></span>

<span data-ttu-id="31446-257">Eine App konfiguriert die Cache Implementierung mithilfe einer- <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> Instanz ( <xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*> ) in einer nicht-Entwicklungsumgebung in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-257">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.StackExchangeRedisCacheServiceCollectionExtensions.AddStackExchangeRedisCache*>) in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddStackExchangeRedisCache)]

<span data-ttu-id="31446-258">So installieren Sie redis auf dem lokalen Computer:</span><span class="sxs-lookup"><span data-stu-id="31446-258">To install Redis on your local machine:</span></span>

1. <span data-ttu-id="31446-259">Installieren Sie das [Chocolatey redis-Paket](https://chocolatey.org/packages/redis-64/).</span><span class="sxs-lookup"><span data-stu-id="31446-259">Install the [Chocolatey Redis package](https://chocolatey.org/packages/redis-64/).</span></span>
1. <span data-ttu-id="31446-260">Führen Sie `redis-server` an einer Eingabeaufforderung aus.</span><span class="sxs-lookup"><span data-stu-id="31446-260">Run `redis-server` from a command prompt.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="31446-261">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-261">Distributed NCache Cache</span></span>

<span data-ttu-id="31446-262">[NCache](https://github.com/Alachisoft/NCache) ist ein Open Source-verteilter, in-Memory-Cache, der System intern in .net und .net Core entwickelt wurde.</span><span class="sxs-lookup"><span data-stu-id="31446-262">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="31446-263">NCache funktioniert sowohl lokal als auch als verteilter Cache Cluster für eine ASP.net Core-APP, die in Azure oder auf anderen Hostingplattformen ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-263">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="31446-264">Informationen zum Installieren und Konfigurieren von NCache auf Ihrem lokalen Computer finden Sie unter Leitfaden für die ersten Schritte [für Windows (.net und .net Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="31446-264">To install and configure NCache on your local machine, see [Getting Started Guide for Windows (.NET and .NET Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span></span>

<span data-ttu-id="31446-265">So konfigurieren Sie NCache:</span><span class="sxs-lookup"><span data-stu-id="31446-265">To configure NCache:</span></span>

1. <span data-ttu-id="31446-266">Installieren [Sie NCache Open Source nuget](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="31446-266">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="31446-267">Konfigurieren Sie den Cache Cluster in " [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html)".</span><span class="sxs-lookup"><span data-stu-id="31446-267">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="31446-268">Fügen Sie den folgenden Code zu `Startup.ConfigureServices` hinzu:</span><span class="sxs-lookup"><span data-stu-id="31446-268">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="31446-269">Verwenden des verteilten Caches</span><span class="sxs-lookup"><span data-stu-id="31446-269">Use the distributed cache</span></span>

<span data-ttu-id="31446-270">Um die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle zu verwenden, fordern Sie eine Instanz von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> von einem beliebigen Konstruktor in der APP an.</span><span class="sxs-lookup"><span data-stu-id="31446-270">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="31446-271">Die-Instanz wird von der [Abhängigkeitsinjektion (di)](xref:fundamentals/dependency-injection)bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="31446-271">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="31446-272">Wenn die Beispiel-App gestartet wird, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in eingefügt `Startup.Configure` .</span><span class="sxs-lookup"><span data-stu-id="31446-272">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="31446-273">Die aktuelle Zeit wird mithilfe von zwischengespeichert <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (Weitere Informationen finden Sie unter [Webhost: iapplicationlifetime-Schnittstelle](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span><span class="sxs-lookup"><span data-stu-id="31446-273">The current time is cached using <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (for more information, see [Web Host: IApplicationLifetime interface](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="31446-274">Die Beispiel-APP <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in den eingefügt, `IndexModel` um von der Index Seite verwendet werden zu können.</span><span class="sxs-lookup"><span data-stu-id="31446-274">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="31446-275">Jedes Mal, wenn die Index Seite geladen wird, wird der Cache für die zwischengespeicherte Zeit in geprüft `OnGetAsync` .</span><span class="sxs-lookup"><span data-stu-id="31446-275">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="31446-276">Wenn die zwischengespeicherte Zeit nicht abgelaufen ist, wird die Uhrzeit angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-276">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="31446-277">Wenn 20 Sekunden seit dem letzten Zugriff auf die zwischengespeicherte Zeit (beim letzten Laden dieser Seite) verstrichen sind, wird auf der Seite die *zwischengespeicherte Zeit abgelaufen* angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-277">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="31446-278">Aktualisieren Sie die zwischengespeicherte Zeit sofort auf die aktuelle Zeit, indem Sie die Schaltfläche **zwischengespeicherte Zeit zurücksetzen** auswählen.</span><span class="sxs-lookup"><span data-stu-id="31446-278">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="31446-279">Die Schaltfläche löst die `OnPostResetCachedTime` Handlermethode aus.</span><span class="sxs-lookup"><span data-stu-id="31446-279">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="31446-280">Es ist nicht erforderlich, eine Singleton-oder Gültigkeitsdauer für <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanzen (zumindest für die integrierten Implementierungen) zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-280">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="31446-281">Sie können auch immer dann eine <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanz erstellen, wenn Sie eine Instanz benötigen, anstatt di zu verwenden, aber das Erstellen einer Instanz im Code kann dazu führen, dass Ihr Code schwieriger zu testen ist und gegen das [explizite Abhängigkeits Prinzip](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies)verstößt.</span><span class="sxs-lookup"><span data-stu-id="31446-281">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="31446-282">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="31446-282">Recommendations</span></span>

<span data-ttu-id="31446-283"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>Beachten Sie Folgendes, wenn Sie entscheiden, welche Implementierung von für Ihre APP am besten geeignet ist:</span><span class="sxs-lookup"><span data-stu-id="31446-283">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="31446-284">Vorhandene Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="31446-284">Existing infrastructure</span></span>
* <span data-ttu-id="31446-285">Leistungsanforderungen</span><span class="sxs-lookup"><span data-stu-id="31446-285">Performance requirements</span></span>
* <span data-ttu-id="31446-286">„Cost“ (Kosten)</span><span class="sxs-lookup"><span data-stu-id="31446-286">Cost</span></span>
* <span data-ttu-id="31446-287">Team Darstellung</span><span class="sxs-lookup"><span data-stu-id="31446-287">Team experience</span></span>

<span data-ttu-id="31446-288">Zwischen Speicherungs Lösungen basieren in der Regel auf in-Memory-Speicher, um das schnelle Abrufen von zwischengespeicherten Daten zu ermöglichen, aber der Arbeitsspeicher ist eine begrenzte Ressource und ist aufwändig</span><span class="sxs-lookup"><span data-stu-id="31446-288">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="31446-289">Speichert nur häufig verwendete Daten in einem Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-289">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="31446-290">Im Allgemeinen bietet ein redis Cache einen höheren Durchsatz und eine niedrigere Latenz als bei einem SQL Server Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-290">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="31446-291">Es ist jedoch normalerweise ein Benchmarkwert erforderlich, um die Leistungsmerkmale von Cache Strategien zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="31446-291">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="31446-292">Wenn SQL Server als Sicherungs Speicher für verteilte Caches verwendet wird, kann sich die Verwendung der gleichen Datenbank für den Cache und den normalen Datenspeicher und-Abruf der APP negativ auf die Leistung beider Anwendungen auswirken.</span><span class="sxs-lookup"><span data-stu-id="31446-292">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="31446-293">Es wird empfohlen, für den Sicherungs Speicher im verteilten Cache eine dedizierte SQL Server Instanz zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-293">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="31446-294">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="31446-294">Additional resources</span></span>

* [<span data-ttu-id="31446-295">Redis Cache in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-295">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="31446-296">SQL-Datenbank in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-296">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="31446-297">[ASP.net Core idistributedcache-Anbieter für NCache in Webfarmen](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="31446-297">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="31446-298">Bei einem verteilten Cache handelt es sich um einen Cache, der von mehreren App-Servern gemeinsam verwendet wird, die in der Regel als externer Dienst für die App-Server verwaltet werden</span><span class="sxs-lookup"><span data-stu-id="31446-298">A distributed cache is a cache shared by multiple app servers, typically maintained as an external service to the app servers that access it.</span></span> <span data-ttu-id="31446-299">Ein verteilter Cache kann die Leistung und Skalierbarkeit einer ASP.net Core-App verbessern, insbesondere wenn die APP von einem Cloud-Dienst oder einer Serverfarm gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-299">A distributed cache can improve the performance and scalability of an ASP.NET Core app, especially when the app is hosted by a cloud service or a server farm.</span></span>

<span data-ttu-id="31446-300">Ein verteilter Cache hat mehrere Vorteile gegenüber anderen cachingszenarien, in denen zwischengespeicherte Daten auf einzelnen App-Servern gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="31446-300">A distributed cache has several advantages over other caching scenarios where cached data is stored on individual app servers.</span></span>

<span data-ttu-id="31446-301">Wenn zwischengespeicherte Daten verteilt werden, sind die Daten wie folgt:</span><span class="sxs-lookup"><span data-stu-id="31446-301">When cached data is distributed, the data:</span></span>

* <span data-ttu-id="31446-302">Ist *in* allen Anforderungen an mehrere Server konsistent (konsistent).</span><span class="sxs-lookup"><span data-stu-id="31446-302">Is *coherent* (consistent) across requests to multiple servers.</span></span>
* <span data-ttu-id="31446-303">Überstehen Serverneustarts und App-bereit Stellungen.</span><span class="sxs-lookup"><span data-stu-id="31446-303">Survives server restarts and app deployments.</span></span>
* <span data-ttu-id="31446-304">Verwendet keinen lokalen Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="31446-304">Doesn't use local memory.</span></span>

<span data-ttu-id="31446-305">Die Konfiguration verteilter Caches ist Implementierungs spezifisch.</span><span class="sxs-lookup"><span data-stu-id="31446-305">Distributed cache configuration is implementation specific.</span></span> <span data-ttu-id="31446-306">In diesem Artikel wird beschrieben, wie Sie SQL Server und verteilte redis-Caches konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="31446-306">This article describes how to configure SQL Server and Redis distributed caches.</span></span> <span data-ttu-id="31446-307">Implementierungen von Drittanbietern sind ebenfalls verfügbar, wie z. b. [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache)).</span><span class="sxs-lookup"><span data-stu-id="31446-307">Third party implementations are also available, such as [NCache](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache)).</span></span> <span data-ttu-id="31446-308">Unabhängig davon, welche Implementierung ausgewählt ist, interagiert die App mithilfe der-Schnittstelle mit dem Cache <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-308">Regardless of which implementation is selected, the app interacts with the cache using the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface.</span></span>

<span data-ttu-id="31446-309">[Anzeigen oder Herunterladen von Beispielcode](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([Vorgehensweise zum Herunterladen](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="31446-309">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/performance/caching/distributed/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="prerequisites"></a><span data-ttu-id="31446-310">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="31446-310">Prerequisites</span></span>

<span data-ttu-id="31446-311">Wenn Sie einen SQL Server verteilten Cache verwenden möchten, verweisen Sie auf das [Metapaket "Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) ", oder fügen Sie dem Paket " [Microsoft. Extensions. Caching. SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) " einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-311">To use a SQL Server distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) or add a package reference to the [Microsoft.Extensions.Caching.SqlServer](https://www.nuget.org/packages/Microsoft.Extensions.Caching.SqlServer) package.</span></span>

<span data-ttu-id="31446-312">Um einen verteilten redis-Cache zu verwenden, verweisen Sie auf das [Metapaket "Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) ", und fügen Sie dem Paket " [Microsoft. Extensions. Caching. redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) " einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-312">To use a Redis distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [Microsoft.Extensions.Caching.Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.Redis) package.</span></span> <span data-ttu-id="31446-313">Das redis-Paket ist nicht im `Microsoft.AspNetCore.App` Paket enthalten. Daher müssen Sie das redis-Paket separat in der Projektdatei referenzieren.</span><span class="sxs-lookup"><span data-stu-id="31446-313">The Redis package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the Redis package separately in your project file.</span></span>

<span data-ttu-id="31446-314">Um den verteilten NCache-Cache zu verwenden, verweisen Sie auf das [Metapaket "Microsoft. aspnetcore. app](xref:fundamentals/metapackage-app) ", und fügen Sie dem [ncache. Microsoft. Extensions. Caching. opensource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) -Paket einen Paket Verweis hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-314">To use NCache distributed cache, reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) and add a package reference to the [NCache.Microsoft.Extensions.Caching.OpenSource](https://www.nuget.org/packages/NCache.Microsoft.Extensions.Caching.OpenSource) package.</span></span> <span data-ttu-id="31446-315">Das NCache-Paket ist nicht im `Microsoft.AspNetCore.App` Paket enthalten. Daher müssen Sie in der Projektdatei separat auf das NCache-Paket verweisen.</span><span class="sxs-lookup"><span data-stu-id="31446-315">The NCache package isn't included in the `Microsoft.AspNetCore.App` package, so you must reference the NCache package separately in your project file.</span></span>

## <a name="idistributedcache-interface"></a><span data-ttu-id="31446-316">Idistributedcache-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="31446-316">IDistributedCache interface</span></span>

<span data-ttu-id="31446-317">Die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle stellt die folgenden Methoden zum Bearbeiten von Elementen in der Implementierung verteilter Caches bereit:</span><span class="sxs-lookup"><span data-stu-id="31446-317">The <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface provides the following methods to manipulate items in the distributed cache implementation:</span></span>

* <span data-ttu-id="31446-318"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*> : Akzeptiert einen Zeichen folgen Schlüssel und ruft ein zwischengespeichertes Element als-Array ab, `byte[]` Wenn es im Cache gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="31446-318"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Get*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.GetAsync*>: Accepts a string key and retrieves a cached item as a `byte[]` array if found in the cache.</span></span>
* <span data-ttu-id="31446-319"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*> : Fügt dem Cache ein Element (als `byte[]` Array) mithilfe eines Zeichen folgen Schlüssels hinzu.</span><span class="sxs-lookup"><span data-stu-id="31446-319"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Set*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.SetAsync*>: Adds an item (as `byte[]` array) to the cache using a string key.</span></span>
* <span data-ttu-id="31446-320"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*> : Aktualisiert ein Element im Cache auf der Grundlage seines Schlüssels und setzt das gleitende Ablauf Timeout (sofern vorhanden) zurück.</span><span class="sxs-lookup"><span data-stu-id="31446-320"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Refresh*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RefreshAsync*>: Refreshes an item in the cache based on its key, resetting its sliding expiration timeout (if any).</span></span>
* <span data-ttu-id="31446-321"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*> : Entfernt ein Cache Element basierend auf seinem Zeichen folgen Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="31446-321"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.Remove*>, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache.RemoveAsync*>: Removes a cache item based on its string key.</span></span>

## <a name="establish-distributed-caching-services"></a><span data-ttu-id="31446-322">Einrichten verteilter Cache Dienste</span><span class="sxs-lookup"><span data-stu-id="31446-322">Establish distributed caching services</span></span>

<span data-ttu-id="31446-323">Registrieren Sie eine Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="31446-323">Register an implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="31446-324">Die in diesem Thema beschriebenen Framework-Implementierungen umfassen Folgendes:</span><span class="sxs-lookup"><span data-stu-id="31446-324">Framework-provided implementations described in this topic include:</span></span>

* [<span data-ttu-id="31446-325">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-325">Distributed Memory Cache</span></span>](#distributed-memory-cache)
* [<span data-ttu-id="31446-326">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-326">Distributed SQL Server cache</span></span>](#distributed-sql-server-cache)
* [<span data-ttu-id="31446-327">Verteilter redis-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-327">Distributed Redis cache</span></span>](#distributed-redis-cache)
* [<span data-ttu-id="31446-328">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-328">Distributed NCache cache</span></span>](#distributed-ncache-cache)

### <a name="distributed-memory-cache"></a><span data-ttu-id="31446-329">Verteilter Speicher Cache</span><span class="sxs-lookup"><span data-stu-id="31446-329">Distributed Memory Cache</span></span>

<span data-ttu-id="31446-330">Der verteilte Arbeitsspeicher Cache ( <xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*> ) ist eine vom Framework bereitgestellte Implementierung von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> , die Elemente im Arbeitsspeicher speichert.</span><span class="sxs-lookup"><span data-stu-id="31446-330">The Distributed Memory Cache (<xref:Microsoft.Extensions.DependencyInjection.MemoryCacheServiceCollectionExtensions.AddDistributedMemoryCache*>) is a framework-provided implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> that stores items in memory.</span></span> <span data-ttu-id="31446-331">Der verteilte Arbeitsspeicher Cache ist kein tatsächlicher verteilter Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-331">The Distributed Memory Cache isn't an actual distributed cache.</span></span> <span data-ttu-id="31446-332">Zwischengespeicherte Elemente werden von der app-Instanz auf dem Server gespeichert, auf dem die app ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-332">Cached items are stored by the app instance on the server where the app is running.</span></span>

<span data-ttu-id="31446-333">Der verteilte Arbeitsspeicher Cache ist eine nützliche Implementierung:</span><span class="sxs-lookup"><span data-stu-id="31446-333">The Distributed Memory Cache is a useful implementation:</span></span>

* <span data-ttu-id="31446-334">In Entwicklungs-und Testszenarien.</span><span class="sxs-lookup"><span data-stu-id="31446-334">In development and testing scenarios.</span></span>
* <span data-ttu-id="31446-335">Wenn ein einzelner Server in der Produktionsumgebung verwendet wird, ist der Arbeitsspeicher Verbrauch kein Problem.</span><span class="sxs-lookup"><span data-stu-id="31446-335">When a single server is used in production and memory consumption isn't an issue.</span></span> <span data-ttu-id="31446-336">Durch das Implementieren des Cache für verteilte Arbeitsspeicher wird der zwischengespeicherte Datenspeicher</span><span class="sxs-lookup"><span data-stu-id="31446-336">Implementing the Distributed Memory Cache abstracts cached data storage.</span></span> <span data-ttu-id="31446-337">Sie ermöglicht die Implementierung einer echten verteilten cachinglösung in Zukunft, wenn mehrere Knoten oder Fehlertoleranz erforderlich werden.</span><span class="sxs-lookup"><span data-stu-id="31446-337">It allows for implementing a true distributed caching solution in the future if multiple nodes or fault tolerance become necessary.</span></span>

<span data-ttu-id="31446-338">Die Beispiel-App nutzt den verteilten Arbeitsspeicher Cache, wenn die app in der Entwicklungsumgebung in ausgeführt wird `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-338">The sample app makes use of the Distributed Memory Cache when the app is run in the Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedMemoryCache)]

### <a name="distributed-sql-server-cache"></a><span data-ttu-id="31446-339">Verteilter SQL Server Cache</span><span class="sxs-lookup"><span data-stu-id="31446-339">Distributed SQL Server Cache</span></span>

<span data-ttu-id="31446-340">Die verteilte SQL Server Cache Implementierung ( <xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*> ) ermöglicht es dem verteilten Cache, eine SQL Server Datenbank als Sicherungs Speicher zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-340">The Distributed SQL Server Cache implementation (<xref:Microsoft.Extensions.DependencyInjection.SqlServerCachingServicesExtensions.AddDistributedSqlServerCache*>) allows the distributed cache to use a SQL Server database as its backing store.</span></span> <span data-ttu-id="31446-341">Zum Erstellen einer SQL Server zwischengespeicherten Element Tabelle in einer SQL Server Instanz können Sie das `sql-cache` Tool verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-341">To create a SQL Server cached item table in a SQL Server instance, you can use the `sql-cache` tool.</span></span> <span data-ttu-id="31446-342">Das Tool erstellt eine Tabelle mit dem Namen und dem Schema, die Sie angeben.</span><span class="sxs-lookup"><span data-stu-id="31446-342">The tool creates a table with the name and schema that you specify.</span></span>

<span data-ttu-id="31446-343">Erstellen Sie eine Tabelle in SQL Server, indem Sie den `sql-cache create` Befehl ausführen.</span><span class="sxs-lookup"><span data-stu-id="31446-343">Create a table in SQL Server by running the `sql-cache create` command.</span></span> <span data-ttu-id="31446-344">Geben Sie die SQL Server Instanz ( `Data Source` ), die Datenbank ( `Initial Catalog` ), das Schema (z. b. `dbo` ) und den Tabellennamen (z. b. `TestCache` ) an:</span><span class="sxs-lookup"><span data-stu-id="31446-344">Provide the SQL Server instance (`Data Source`), database (`Initial Catalog`), schema (for example, `dbo`), and table name (for example, `TestCache`):</span></span>

```dotnetcli
dotnet sql-cache create "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=DistCache;Integrated Security=True;" dbo TestCache
```

<span data-ttu-id="31446-345">Eine Meldung wird protokolliert, um anzuzeigen, dass das Tool erfolgreich war:</span><span class="sxs-lookup"><span data-stu-id="31446-345">A message is logged to indicate that the tool was successful:</span></span>

```console
Table and index were created successfully.
```

<span data-ttu-id="31446-346">Die vom Tool erstellte Tabelle `sql-cache` hat das folgende Schema:</span><span class="sxs-lookup"><span data-stu-id="31446-346">The table created by the `sql-cache` tool has the following schema:</span></span>

![SQLServer-Cache Tabelle](distributed/_static/SqlServerCacheTable.png)

> [!NOTE]
> <span data-ttu-id="31446-348">Eine APP sollte Cache Werte mithilfe einer Instanz von, nicht mithilfe von bearbeiten <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> .</span><span class="sxs-lookup"><span data-stu-id="31446-348">An app should manipulate cache values using an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>, not a <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache>.</span></span>

<span data-ttu-id="31446-349">Die Beispiel-App implementiert in <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> einer nicht Entwicklungsumgebung in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="31446-349">The sample app implements <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCache> in a non-Development environment in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_AddDistributedSqlServerCache)]

> [!NOTE]
> <span data-ttu-id="31446-350">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (und optional <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> und <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*> ) werden in der Regel außerhalb der Quell Code Verwaltung gespeichert (z. b. durch den [Geheimnis-Manager](xref:security/app-secrets) oder in *appsettings.json* / *appSettings gespeichert. { Umgebung}. JSON* -Dateien).</span><span class="sxs-lookup"><span data-stu-id="31446-350">A <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.ConnectionString*> (and optionally, <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.SchemaName*> and <xref:Microsoft.Extensions.Caching.SqlServer.SqlServerCacheOptions.TableName*>) are typically stored outside of source control (for example, stored by the [Secret Manager](xref:security/app-secrets) or in *appsettings.json*/*appsettings.{ENVIRONMENT}.json* files).</span></span> <span data-ttu-id="31446-351">Die Verbindungs Zeichenfolge kann Anmelde Informationen enthalten, die aus den Quell Code Verwaltungssystemen ausgeschlossen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="31446-351">The connection string may contain credentials that should be kept out of source control systems.</span></span>

### <a name="distributed-redis-cache"></a><span data-ttu-id="31446-352">Verteilte redis Cache</span><span class="sxs-lookup"><span data-stu-id="31446-352">Distributed Redis Cache</span></span>

<span data-ttu-id="31446-353">[Redis](https://redis.io/) ist ein Open Source-Datenspeicher im Arbeitsspeicher, der häufig als verteilter Cache verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="31446-353">[Redis](https://redis.io/) is an open source in-memory data store, which is often used as a distributed cache.</span></span> <span data-ttu-id="31446-354">Sie können redis lokal verwenden, und Sie können eine [Azure redis Cache](https://azure.microsoft.com/services/cache/) für eine in Azure gehostete ASP.net Core-App konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="31446-354">You can use Redis locally, and you can configure an [Azure Redis Cache](https://azure.microsoft.com/services/cache/) for an Azure-hosted ASP.NET Core app.</span></span>

<span data-ttu-id="31446-355">Eine App konfiguriert die Cache Implementierung mithilfe einer- <xref:Microsoft.Extensions.Caching.Redis.RedisCache> Instanz ( <xref:Microsoft.Extensions.DependencyInjection.RedisCacheServiceCollectionExtensions.AddDistributedRedisCache*> ):</span><span class="sxs-lookup"><span data-stu-id="31446-355">An app configures the cache implementation using a <xref:Microsoft.Extensions.Caching.Redis.RedisCache> instance (<xref:Microsoft.Extensions.DependencyInjection.RedisCacheServiceCollectionExtensions.AddDistributedRedisCache*>):</span></span>

```csharp
services.AddDistributedRedisCache(options =>
{
    options.Configuration = "localhost";
    options.InstanceName = "SampleInstance";
});
```

<span data-ttu-id="31446-356">So installieren Sie redis auf dem lokalen Computer:</span><span class="sxs-lookup"><span data-stu-id="31446-356">To install Redis on your local machine:</span></span>

1. <span data-ttu-id="31446-357">Installieren Sie das [Chocolatey redis-Paket](https://chocolatey.org/packages/redis-64/).</span><span class="sxs-lookup"><span data-stu-id="31446-357">Install the [Chocolatey Redis package](https://chocolatey.org/packages/redis-64/).</span></span>
1. <span data-ttu-id="31446-358">Führen Sie `redis-server` an einer Eingabeaufforderung aus.</span><span class="sxs-lookup"><span data-stu-id="31446-358">Run `redis-server` from a command prompt.</span></span>

### <a name="distributed-ncache-cache"></a><span data-ttu-id="31446-359">Verteilter NCache-Cache</span><span class="sxs-lookup"><span data-stu-id="31446-359">Distributed NCache Cache</span></span>

<span data-ttu-id="31446-360">[NCache](https://github.com/Alachisoft/NCache) ist ein Open Source-verteilter, in-Memory-Cache, der System intern in .net und .net Core entwickelt wurde.</span><span class="sxs-lookup"><span data-stu-id="31446-360">[NCache](https://github.com/Alachisoft/NCache) is an open source in-memory distributed cache developed natively in .NET and .NET Core.</span></span> <span data-ttu-id="31446-361">NCache funktioniert sowohl lokal als auch als verteilter Cache Cluster für eine ASP.net Core-APP, die in Azure oder auf anderen Hostingplattformen ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="31446-361">NCache works both locally and configured as a distributed cache cluster for an ASP.NET Core app running in Azure or on other hosting platforms.</span></span>

<span data-ttu-id="31446-362">Informationen zum Installieren und Konfigurieren von NCache auf Ihrem lokalen Computer finden Sie unter Leitfaden für die ersten Schritte [für Windows (.net und .net Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span><span class="sxs-lookup"><span data-stu-id="31446-362">To install and configure NCache on your local machine, see [Getting Started Guide for Windows (.NET and .NET Core)](https://www.alachisoft.com/resources/docs/ncache/getting-started-guide-windows/).</span></span>

<span data-ttu-id="31446-363">So konfigurieren Sie NCache:</span><span class="sxs-lookup"><span data-stu-id="31446-363">To configure NCache:</span></span>

1. <span data-ttu-id="31446-364">Installieren [Sie NCache Open Source nuget](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span><span class="sxs-lookup"><span data-stu-id="31446-364">Install [NCache open source NuGet](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/).</span></span>
1. <span data-ttu-id="31446-365">Konfigurieren Sie den Cache Cluster in " [Client. ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html)".</span><span class="sxs-lookup"><span data-stu-id="31446-365">Configure the cache cluster in [client.ncconf](https://www.alachisoft.com/resources/docs/ncache/admin-guide/client-config.html).</span></span>
1. <span data-ttu-id="31446-366">Fügen Sie den folgenden Code zu `Startup.ConfigureServices` hinzu:</span><span class="sxs-lookup"><span data-stu-id="31446-366">Add the following code to `Startup.ConfigureServices`:</span></span>

   ```csharp
   services.AddNCacheDistributedCache(configuration =>    
   {        
       configuration.CacheName = "demoClusteredCache";
       configuration.EnableLogs = true;
       configuration.ExceptionsEnabled = true;
   });
   ```

## <a name="use-the-distributed-cache"></a><span data-ttu-id="31446-367">Verwenden des verteilten Caches</span><span class="sxs-lookup"><span data-stu-id="31446-367">Use the distributed cache</span></span>

<span data-ttu-id="31446-368">Um die- <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Schnittstelle zu verwenden, fordern Sie eine Instanz von <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> von einem beliebigen Konstruktor in der APP an.</span><span class="sxs-lookup"><span data-stu-id="31446-368">To use the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> interface, request an instance of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> from any constructor in the app.</span></span> <span data-ttu-id="31446-369">Die-Instanz wird von der [Abhängigkeitsinjektion (di)](xref:fundamentals/dependency-injection)bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="31446-369">The instance is provided by [dependency injection (DI)](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="31446-370">Wenn die Beispiel-App gestartet wird, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in eingefügt `Startup.Configure` .</span><span class="sxs-lookup"><span data-stu-id="31446-370">When the sample app starts, <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is injected into `Startup.Configure`.</span></span> <span data-ttu-id="31446-371">Die aktuelle Zeit wird mithilfe von zwischengespeichert <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (Weitere Informationen finden Sie unter [Webhost: iapplicationlifetime-Schnittstelle](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span><span class="sxs-lookup"><span data-stu-id="31446-371">The current time is cached using <xref:Microsoft.AspNetCore.Hosting.IApplicationLifetime> (for more information, see [Web Host: IApplicationLifetime interface](xref:fundamentals/host/web-host#iapplicationlifetime-interface)):</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Startup.cs?name=snippet_Configure&highlight=10)]

<span data-ttu-id="31446-372">Die Beispiel-APP <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> wird in den eingefügt, `IndexModel` um von der Index Seite verwendet werden zu können.</span><span class="sxs-lookup"><span data-stu-id="31446-372">The sample app injects <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> into the `IndexModel` for use by the Index page.</span></span>

<span data-ttu-id="31446-373">Jedes Mal, wenn die Index Seite geladen wird, wird der Cache für die zwischengespeicherte Zeit in geprüft `OnGetAsync` .</span><span class="sxs-lookup"><span data-stu-id="31446-373">Each time the Index page is loaded, the cache is checked for the cached time in `OnGetAsync`.</span></span> <span data-ttu-id="31446-374">Wenn die zwischengespeicherte Zeit nicht abgelaufen ist, wird die Uhrzeit angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-374">If the cached time hasn't expired, the time is displayed.</span></span> <span data-ttu-id="31446-375">Wenn 20 Sekunden seit dem letzten Zugriff auf die zwischengespeicherte Zeit (beim letzten Laden dieser Seite) verstrichen sind, wird auf der Seite die *zwischengespeicherte Zeit abgelaufen* angezeigt.</span><span class="sxs-lookup"><span data-stu-id="31446-375">If 20 seconds have elapsed since the last time the cached time was accessed (the last time this page was loaded), the page displays *Cached Time Expired*.</span></span>

<span data-ttu-id="31446-376">Aktualisieren Sie die zwischengespeicherte Zeit sofort auf die aktuelle Zeit, indem Sie die Schaltfläche **zwischengespeicherte Zeit zurücksetzen** auswählen.</span><span class="sxs-lookup"><span data-stu-id="31446-376">Immediately update the cached time to the current time by selecting the **Reset Cached Time** button.</span></span> <span data-ttu-id="31446-377">Die Schaltfläche löst die `OnPostResetCachedTime` Handlermethode aus.</span><span class="sxs-lookup"><span data-stu-id="31446-377">The button triggers the `OnPostResetCachedTime` handler method.</span></span>

[!code-csharp[](distributed/samples/2.x/DistCacheSample/Pages/Index.cshtml.cs?name=snippet_IndexModel&highlight=7,14-20,25-29)]

> [!NOTE]
> <span data-ttu-id="31446-378">Es ist nicht erforderlich, eine Singleton-oder Gültigkeitsdauer für <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanzen (zumindest für die integrierten Implementierungen) zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-378">There's no need to use a Singleton or Scoped lifetime for <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instances (at least for the built-in implementations).</span></span>
>
> <span data-ttu-id="31446-379">Sie können auch immer dann eine <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> Instanz erstellen, wenn Sie eine Instanz benötigen, anstatt di zu verwenden, aber das Erstellen einer Instanz im Code kann dazu führen, dass Ihr Code schwieriger zu testen ist und gegen das [explizite Abhängigkeits Prinzip](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies)verstößt.</span><span class="sxs-lookup"><span data-stu-id="31446-379">You can also create an <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> instance wherever you might need one instead of using DI, but creating an instance in code can make your code harder to test and violates the [Explicit Dependencies Principle](/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#explicit-dependencies).</span></span>

## <a name="recommendations"></a><span data-ttu-id="31446-380">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="31446-380">Recommendations</span></span>

<span data-ttu-id="31446-381"><xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache>Beachten Sie Folgendes, wenn Sie entscheiden, welche Implementierung von für Ihre APP am besten geeignet ist:</span><span class="sxs-lookup"><span data-stu-id="31446-381">When deciding which implementation of <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> is best for your app, consider the following:</span></span>

* <span data-ttu-id="31446-382">Vorhandene Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="31446-382">Existing infrastructure</span></span>
* <span data-ttu-id="31446-383">Leistungsanforderungen</span><span class="sxs-lookup"><span data-stu-id="31446-383">Performance requirements</span></span>
* <span data-ttu-id="31446-384">„Cost“ (Kosten)</span><span class="sxs-lookup"><span data-stu-id="31446-384">Cost</span></span>
* <span data-ttu-id="31446-385">Team Darstellung</span><span class="sxs-lookup"><span data-stu-id="31446-385">Team experience</span></span>

<span data-ttu-id="31446-386">Zwischen Speicherungs Lösungen basieren in der Regel auf in-Memory-Speicher, um das schnelle Abrufen von zwischengespeicherten Daten zu ermöglichen, aber der Arbeitsspeicher ist eine begrenzte Ressource und ist aufwändig</span><span class="sxs-lookup"><span data-stu-id="31446-386">Caching solutions usually rely on in-memory storage to provide fast retrieval of cached data, but memory is a limited resource and costly to expand.</span></span> <span data-ttu-id="31446-387">Speichert nur häufig verwendete Daten in einem Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-387">Only store commonly used data in a cache.</span></span>

<span data-ttu-id="31446-388">Im Allgemeinen bietet ein redis Cache einen höheren Durchsatz und eine niedrigere Latenz als bei einem SQL Server Cache.</span><span class="sxs-lookup"><span data-stu-id="31446-388">Generally, a Redis cache provides higher throughput and lower latency than a SQL Server cache.</span></span> <span data-ttu-id="31446-389">Es ist jedoch normalerweise ein Benchmarkwert erforderlich, um die Leistungsmerkmale von Cache Strategien zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="31446-389">However, benchmarking is usually required to determine the performance characteristics of caching strategies.</span></span>

<span data-ttu-id="31446-390">Wenn SQL Server als Sicherungs Speicher für verteilte Caches verwendet wird, kann sich die Verwendung der gleichen Datenbank für den Cache und den normalen Datenspeicher und-Abruf der APP negativ auf die Leistung beider Anwendungen auswirken.</span><span class="sxs-lookup"><span data-stu-id="31446-390">When SQL Server is used as a distributed cache backing store, use of the same database for the cache and the app's ordinary data storage and retrieval can negatively impact the performance of both.</span></span> <span data-ttu-id="31446-391">Es wird empfohlen, für den Sicherungs Speicher im verteilten Cache eine dedizierte SQL Server Instanz zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="31446-391">We recommend using a dedicated SQL Server instance for the distributed cache backing store.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="31446-392">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="31446-392">Additional resources</span></span>

* [<span data-ttu-id="31446-393">Redis Cache in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-393">Redis Cache on Azure</span></span>](/azure/azure-cache-for-redis/)
* [<span data-ttu-id="31446-394">SQL-Datenbank in Azure</span><span class="sxs-lookup"><span data-stu-id="31446-394">SQL Database on Azure</span></span>](/azure/sql-database/)
* <span data-ttu-id="31446-395">[ASP.net Core idistributedcache-Anbieter für NCache in Webfarmen](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache auf GitHub](https://github.com/Alachisoft/NCache))</span><span class="sxs-lookup"><span data-stu-id="31446-395">[ASP.NET Core IDistributedCache Provider for NCache in Web Farms](http://www.alachisoft.com/ncache/aspnet-core-idistributedcache-ncache.html) ([NCache on GitHub](https://github.com/Alachisoft/NCache))</span></span>
* <xref:performance/caching/memory>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/response>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>
* <xref:host-and-deploy/web-farm>

::: moniker-end
